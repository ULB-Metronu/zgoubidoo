

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>zgoubidoo.commands.commands &mdash; Zgoubidoo 2020.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Zgoubidoo
          

          
          </a>

          
            
            
              <div class="version">
                2020.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../news.html">News and announcements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zgoubi.html">Zgoubi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../commands.html">Zgoubi commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contrib.html">Zgoubidoo specialized and contributed commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../input.html">Working with Zgoubi Input</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../lowlevel.html">Using the Zgoubidoo low-level interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fieldmaps.html">Field maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../physics.html">Physics with Zgoubidoo high-level interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../vis.html">Zgoubidoo’s visualization and plotting module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utilities.html">Zgoubidoo’s utility modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Examples</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Zgoubidoo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>zgoubidoo.commands.commands</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for zgoubidoo.commands.commands</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Commands controlling Zgoubi&#39;s control flow, geometry, tracking options, etc.</span>

<span class="sd">TODO</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">_np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">_pd</span>
<span class="kn">import</span> <span class="nn">parse</span> <span class="k">as</span> <span class="nn">_parse</span>
<span class="kn">from</span> <span class="nn">pint</span> <span class="kn">import</span> <span class="n">UndefinedUnitError</span> <span class="k">as</span> <span class="n">_UndefinedUnitError</span>
<span class="kn">from</span> <span class="nn">.patchable</span> <span class="kn">import</span> <span class="n">Patchable</span> <span class="k">as</span> <span class="n">_Patchable</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">ureg</span> <span class="k">as</span> <span class="n">_ureg</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">Q_</span> <span class="k">as</span> <span class="n">_Q</span>
<span class="kn">from</span> <span class="nn">georges_core.frame</span> <span class="kn">import</span> <span class="n">Frame</span> <span class="k">as</span> <span class="n">_Frame</span>
<span class="kn">from</span> <span class="nn">..units</span> <span class="kn">import</span> <span class="n">_radian</span><span class="p">,</span> <span class="n">_degree</span><span class="p">,</span> <span class="n">_m</span><span class="p">,</span> <span class="n">_cm</span>
<span class="kn">from</span> <span class="nn">..constants</span> <span class="kn">import</span> <span class="n">ZGOUBI_LABEL_LENGTH</span> <span class="k">as</span> <span class="n">_ZGOUBI_LABEL_LENGTH</span>
<span class="kn">import</span> <span class="nn">zgoubidoo</span>


<div class="viewcode-block" id="ZgoubidooException"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.ZgoubidooException.html#zgoubidoo.commands.commands.ZgoubidooException">[docs]</a><span class="k">class</span> <span class="nc">ZgoubidooException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception raised for errors in the Zgoubidoo commands module.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">m</span></div>


<div class="viewcode-block" id="ZgoubidooAttributeException"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.ZgoubidooAttributeException.html#zgoubidoo.commands.commands.ZgoubidooAttributeException">[docs]</a><span class="k">class</span> <span class="nc">ZgoubidooAttributeException</span><span class="p">(</span><span class="n">ZgoubidooException</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception raised for errors in the Zgoubidoo commands module.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="Comment"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Comment.html#zgoubidoo.commands.commands.Comment">[docs]</a><span class="k">class</span> <span class="nc">Comment</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Fake comment allowing to insert comments in the Zgoubi input.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; c = Comment(COMMENT=&quot;A very long comment.&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">COMMENT</span> <span class="o">=</span> <span class="n">comment</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        ! </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">COMMENT</span><span class="si">}</span><span class="s2"></span>
<span class="s2">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="CommandType"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.CommandType.html#zgoubidoo.commands.commands.CommandType">[docs]</a><span class="k">class</span> <span class="nc">CommandType</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dark magic.</span>
<span class="sd">    Be careful.</span>

<span class="sd">    TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bases</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">CommandType</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">dct</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="c1"># Insert a default initializer (constructor) in case one is not present</span>
        <span class="k">if</span> <span class="s1">&#39;__init__&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">default_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label1</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;Default initializer for all Commands.&quot;&quot;&quot;</span>
                <span class="n">defaults</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="s1">&#39;post_init&#39;</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
                    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">_</span><span class="p">:</span> <span class="n">__</span><span class="o">.</span><span class="n">default</span>
                        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;post_init&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">__</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span>
                    <span class="p">}</span>
                <span class="n">bases</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label1</span><span class="p">,</span> <span class="n">label2</span><span class="p">,</span> <span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PARAMETERS&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="n">defaults</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">})</span>
                <span class="k">if</span> <span class="s1">&#39;post_init&#39;</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
                    <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;post_init&#39;</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;__init__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_init</span>

        <span class="c1"># Collect all post_init arguments</span>
        <span class="k">if</span> <span class="s1">&#39;_POST_INIT&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
            <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;_POST_INIT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s1">&#39;post_init&#39;</span> <span class="ow">in</span> <span class="n">dct</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">bases</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;_POST_INIT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">*</span><span class="nb">getattr</span><span class="p">(</span><span class="n">bases</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;_POST_INIT&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="o">*</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;post_init&#39;</span><span class="p">]</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">}</span>

        <span class="c1"># Add a default keyword</span>
        <span class="k">if</span> <span class="s1">&#39;KEYWORD&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;KEYWORD&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;KEYWORD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">KEYWORD</span>
                    <span class="k">break</span>

        <span class="c1"># Add comment to all PARAMETERS entry</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PARAMETERS&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;PARAMETERS&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">bases</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;PARAMETERS&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">bases</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;PARAMETERS&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;PARAMETERS&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;PARAMETERS&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bases</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;PARAMETERS&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">bases</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;PARAMETERS&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;PARAMETERS&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">dct</span><span class="p">[</span><span class="s1">&#39;PARAMETERS&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bases</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;PARAMETERS&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span>

        <span class="c1"># Add PARAMETERS from the base class</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;PARAMETERS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="nb">getattr</span><span class="p">(</span><span class="n">bases</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;PARAMETERS&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="o">**</span><span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PARAMETERS&#39;</span><span class="p">,</span> <span class="p">{})}</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bases</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">type</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">dct</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            </span>
<span class="s2">    .. rubric:: Command attributes</span>
<span class="s2">    </span>
<span class="s2">    Attributes:</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">PARAMETERS</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=&#39;</span><span class="si">{</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"></span>
<span class="s2">            &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">PARAMETERS</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)][</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">PARAMETERS</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">PARAMETERS</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">PARAMETERS</span></div>


<div class="viewcode-block" id="Command"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Command.html#zgoubidoo.commands.commands.Command">[docs]</a><span class="k">class</span> <span class="nc">Command</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">CommandType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test test test.</span>

<span class="sd">    More info on this wonderful class.</span>
<span class="sd">    TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;LABEL1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Primary label for the Zgoubi command (default: auto-generated hash).&#39;</span><span class="p">),</span>
        <span class="s1">&#39;LABEL2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Secondary label for the Zgoubi command.&#39;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">CommandResult</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;TODO&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_success</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">success</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">:</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">results</span>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">success</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;TODO&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_success</span>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;TODO&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label1</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>
<span class="sd">        Args:</span>
<span class="sd">            label1:</span>
<span class="sd">            label2:</span>
<span class="sd">            *params:</span>
<span class="sd">            **kwargs:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">_Q</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">_Q</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">Command</span><span class="o">.</span><span class="n">CommandResult</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Command</span><span class="o">.</span><span class="n">PARAMETERS</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_POST_INIT</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">label1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_ZGOUBI_LABEL_LENGTH</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ZgoubidooAttributeException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LABEL1 &#39;</span><span class="si">{</span><span class="n">label1</span><span class="si">}</span><span class="s2">&#39; for element </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">KEYWORD</span><span class="si">}</span><span class="s2"> is too long.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="s1">&#39;LABEL1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label1</span>
        <span class="k">if</span> <span class="n">label2</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_ZGOUBI_LABEL_LENGTH</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ZgoubidooAttributeException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LABEL2 &#39;</span><span class="si">{</span><span class="n">label2</span><span class="si">}</span><span class="s2">&#39; for element </span><span class="si">{</span><span class="n">label1</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">KEYWORD</span><span class="si">}</span><span class="s2">) is too long.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="s1">&#39;LABEL2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label2</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="s1">&#39;LABEL1&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_label</span><span class="p">()</span>
        <span class="n">Command</span><span class="o">.</span><span class="n">post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="Command.generate_label"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Command.html#zgoubidoo.commands.commands.Command.generate_label">[docs]</a>    <span class="k">def</span> <span class="nf">generate_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            prefix:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="s1">&#39;LABEL1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span>
            <span class="n">prefix</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">)</span>
        <span class="p">]))[:</span><span class="n">_ZGOUBI_LABEL_LENGTH</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Command.post_init"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Command.html#zgoubidoo.commands.commands.Command.post_init">[docs]</a>    <span class="k">def</span> <span class="nf">post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># -&gt; NoReturn:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>
<span class="sd">        Args:</span>
<span class="sd">            **kwargs: all arguments from the initializer (constructor) are passed to ``post_init`` as keyword arguments.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO</span>
<span class="sd">        Args:</span>
<span class="sd">            a:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">_Q</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">_Q</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">_</span><span class="o">.</span><span class="n">magnitude</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">_</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">_UndefinedUnitError</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">attr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">attr</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom attribute setter; all non-protected (starting with a &#39;_&#39;) attributes in upper-case are considered</span>
<span class="sd">        parameters of the `Command`. As such, the method will verify that they are indeed part of the command</span>
<span class="sd">        definition, if not an exception is raised. For valid attributes, their dimensionality is verified against the</span>
<span class="sd">        command definition (the dimension of the parameter&#39;s default value).</span>

<span class="sd">        It is also possible to use unit inference by appending an underscore to the attributes&#39; name. In that</span>
<span class="sd">        case the unit of the default value is implicitely used. This is useful in case it is known that the parameter&#39;s</span>
<span class="sd">        numerical value is expressed in Zgoubi&#39;s default units set.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; c = Command()</span>
<span class="sd">            &gt;&gt;&gt; c.LABEL1 = &#39;FOOBAR&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            k: a string representing the attribute</span>
<span class="sd">            v: the attribute&#39;s value to be set</span>

<span class="sd">        Raises:</span>
<span class="sd">            A ZgoubidooException is raised in case the parameter is not part of the class definition or if it has</span>
<span class="sd">            invalid dimension.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k_</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">ZgoubidooAttributeException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The parameter </span><span class="si">{</span><span class="n">k_</span><span class="si">}</span><span class="s2"> is not part of the </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span>
                                                  <span class="sa">f</span><span class="s2">&quot;definition.&quot;</span><span class="p">)</span>

            <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_default_parameter_value</span><span class="p">(</span><span class="n">k_</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># Avoid a bug in pint where a string starting with &#39;#&#39; cannot be parsed</span>
                <span class="n">default</span> <span class="o">=</span> <span class="n">default</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">default</span><span class="p">)</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">_UndefinedUnitError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dimension</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">dimensionality</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">dimension</span> <span class="o">=</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dimensionality</span>  <span class="c1"># No dimension</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dimension</span> <span class="o">!=</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">default</span><span class="p">)</span><span class="o">.</span><span class="n">dimensionality</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ZgoubidooAttributeException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid dimension (</span><span class="si">{</span><span class="n">dimension</span><span class="si">}</span><span class="s2"> &quot;</span>
                                                      <span class="sa">f</span><span class="s2">&quot;instead of </span><span class="si">{</span><span class="n">_ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">default</span><span class="p">)</span><span class="o">.</span><span class="n">dimensionality</span><span class="si">}</span><span class="s2">) &quot;</span>
                                                      <span class="sa">f</span><span class="s2">&quot;for parameter </span><span class="si">{</span><span class="n">k_</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
                                                      <span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="n">_UndefinedUnitError</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">_retrieve_default_parameter_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the default value of a given parameter as defined in the Command definition (class hierarchy).</span>

<span class="sd">        Args:</span>
<span class="sd">            k: the parameter for which the default value is requested.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the default value of the Command&#39;s parameter &#39;k&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARAMETERS</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARAMETERS</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides the string representation of the command in the Zgoubi input file format.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The string representation.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; c = Command(&#39;my_label_1&#39;, &#39;my_label_2&#39;)</span>
<span class="sd">            &gt;&gt;&gt; str(c)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">KEYWORD</span><span class="si">}</span><span class="s2">&#39; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LABEL1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LABEL2</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Object (instance) copy operation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">label2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LABEL2</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">)</span><span class="o">.</span><span class="n">generate_label</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LABEL1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Object (instance) deep copy operation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Comparison based on string representation in the Zgoubi format.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;All attributes.</span>

<span class="sd">        Provides a dictionary with all attributes for the command.</span>

<span class="sd">        Returns: dictionnary with all attributes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Default attributes.</span>

<span class="sd">        Provides a dictionary with all attributes that have been assigned a default value.</span>

<span class="sd">        Returns: dictionary with all default attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARAMETERS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">0</span><span class="p">]}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nondefaults</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Non default attributes.</span>

<span class="sd">        Provides a dictionary with all attributes that have been assigned a non default value.</span>

<span class="sd">        Returns: dictionary with all non default attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARAMETERS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">0</span><span class="p">]}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">_Q</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides the outputs associated with a command after each successive Zgoubi run.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the output, None if no output has been previously attached.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">_Q</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">_pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides the results of a Zgoubi command in the form of a Pandas DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the results, None if not available, a DataFrame otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span>

<div class="viewcode-block" id="Command.clean_output_and_results"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Command.html#zgoubidoo.commands.commands.Command.clean_output_and_results">[docs]</a>    <span class="k">def</span> <span class="nf">clean_output_and_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears the output attached to the command.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the command itself (for method chaining, etc.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Command.attach_output"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Command.html#zgoubidoo.commands.commands.Command.attach_output">[docs]</a>    <span class="k">def</span> <span class="nf">attach_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">outputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                      <span class="n">parameters</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">_Q</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
                      <span class="n">zgoubi_input</span><span class="p">:</span> <span class="n">zgoubidoo</span><span class="o">.</span><span class="n">Input</span><span class="p">,</span>
                      <span class="p">):</span>  <span class="c1"># -&gt; NoReturn:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attach the ouput that an command has generated during a Zgoubi run.</span>

<span class="sd">        Args:</span>
<span class="sd">            outputs: the outputs from a Zgoubi run to be attached to the command.</span>
<span class="sd">            parameters: TODO</span>
<span class="sd">            zgoubi_input: the Input sequence (required for output processing).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parameters</span><span class="p">,</span> <span class="n">outputs</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_output</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">zgoubi_input</span><span class="p">)</span></div>

<div class="viewcode-block" id="Command.process_output"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Command.html#zgoubidoo.commands.commands.Command.process_output">[docs]</a>    <span class="k">def</span> <span class="nf">process_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">output</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                       <span class="n">parameters</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">_Q</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
                       <span class="n">zgoubi_input</span><span class="p">:</span> <span class="n">zgoubidoo</span><span class="o">.</span><span class="n">Input</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            output: the output from a Zgoubi run to be processed by the command.</span>
<span class="sd">            parameters: TODO</span>
<span class="sd">            zgoubi_input: the Input sequence (required and some cases by the command output processor).</span>

<span class="sd">        Returns:</span>
<span class="sd">            a flag indicating if the processing is valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Command.build"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Command.html#zgoubidoo.commands.commands.Command.build">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            stream:</span>
<span class="sd">            debug:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;----------------- </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> detected&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="bp">cls</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span><span class="o">.</span><span class="n">named</span><span class="p">)</span></div>

<div class="viewcode-block" id="Command.parse"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Command.html#zgoubidoo.commands.commands.Command.parse">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">stream</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            stream:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_parse</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; {label1:w}&quot;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span></div></div>


<div class="viewcode-block" id="Fake"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Fake.html#zgoubidoo.commands.commands.Fake">[docs]</a><span class="k">class</span> <span class="nc">Fake</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fake command for Zgoubi input.</span>

<span class="sd">    This command can be used to add an arbitrary input command in a Zgoubi input sequence. The `INPUT` parameter is</span>
<span class="sd">    formatted before being printed, and uses the OPTIONS command attributes list for that purpose (see examples below).</span>

<span class="sd">    This can also be used to implement new commands easily by using formatted INPUT together with OPTIONS.</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; c = Fake(&#39;FAKE1&#39;, INPUT=&quot;&#39;COMMAND_NAME&#39; {LABEL1} 1.0 2.0 3.0&quot;)</span>
<span class="sd">        &gt;&gt;&gt; str(c)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;INPUT&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Input string.&#39;</span><span class="p">),</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">OPTIONS</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">})</span></div>


<div class="viewcode-block" id="AutoRef"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.AutoRef.html#zgoubidoo.commands.commands.AutoRef">[docs]</a><span class="k">class</span> <span class="nc">AutoRef</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Automatic transformation to a new reference frame.</span>

<span class="sd">    .. rubric:: Zgoubi manual description</span>

<span class="sd">    AUTOREF positions the new reference frame following 3 options:</span>

<span class="sd">    - If I = 1, AUTOREF is equivalent to CHANGREF[XCE = 0,Y CE = Y (1),ALE = T(1)] so that the new reference frame is at the exit of the last element, with particle 1 at the origin with its horizontal angle set to T = 0.</span>
<span class="sd">    - If I = 2, it is equivalent to CHANGREF[XW,Y W,T(1)] so that the new reference frame is at the position (X W, Y W ) of the waist (calculated automatically in the same way as for IMAGE) of the three rays number 1, 4 and 5 (compatible for instance with OBJET, KOBJ = 5, 6, together with the use of MATRIX) while T(1), the horizontal angle of particle number I1, is set to zero.</span>
<span class="sd">    - If I = 3, it is equivalent to CHANGREF[XW,Y W,T(I1)] so that the new reference frame is at the position (X W, Y W ) of the waist (calculated automatically in the same way as for IMAGE) of the three rays number I1, I2 and I3 specified as data, while T(I1) is set to zero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;AUTOREF&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Mode (1, 2 or 3).&#39;</span><span class="p">),</span>
        <span class="s1">&#39;I1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Particle number (only used if I = 3)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;I2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Particle number (only used if I = 3)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;I3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Particle number (only used if I = 3)&#39;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">I1</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">I2</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">I3</span><span class="si">}</span><span class="s2"></span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">c</span></div>


<div class="viewcode-block" id="BeamBeam"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.BeamBeam.html#zgoubidoo.commands.commands.BeamBeam">[docs]</a><span class="k">class</span> <span class="nc">BeamBeam</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Beam-beam lens.</span>

<span class="sd">    TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;BEAMBEAM&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Binary"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Binary.html#zgoubidoo.commands.commands.Binary">[docs]</a><span class="k">class</span> <span class="nc">Binary</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;BINARY/FORMATTED data converter.</span>

<span class="sd">    TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;BINARY&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Chambre"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Chambre.html#zgoubidoo.commands.commands.Chambre">[docs]</a><span class="k">class</span> <span class="nc">Chambre</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Long transverse aperture limitation.</span>

<span class="sd">    .. rubric:: Zgoubi manual description</span>

<span class="sd">    CHAMBR causes the identification, counting and stopping of particles that reach the transverse limits of the vacuum</span>
<span class="sd">    chamber. The chamber can be either rectangular (IFORM = 1) or elliptic (IFORM = 2). The chamber is centered at YC,</span>
<span class="sd">    ZC and has transverse dimensions ±Y L and ±ZL such that any particle will be stopped if its coordinates Y, Z</span>
<span class="sd">    satisfy.</span>

<span class="sd">    The conditions introduced with CHAMBR are valid along the optical structure until the next occurrence of the</span>
<span class="sd">    keyword CHAMBR. Then, if IL = 1 the aperture is possibly modified by introducing new values of YC, ZC, Y L and ZL,</span>
<span class="sd">    or, if IL = 2 the chamber ends and information is printed concerning those particles that have been stopped.</span>

<span class="sd">    The testing is done in optical elements at each integration step, between the EFB’s. For instance, in QUADRUPO</span>
<span class="sd">    there will be no testing from −XE to 0 and from XL to XL + XS, but only from 0 to XL ; in DIPOLE, there is no</span>
<span class="sd">    testing as long as the ENTRANCE EFB is not reached, and testing is stopped as soon as the EXIT or LATERAL EFB’s</span>
<span class="sd">    are passed.</span>

<span class="sd">    In optical elements defined in polar coordinates, Y stands for the radial coordinate (e.g., DIPOLE, see Figs. 3C,</span>
<span class="sd">    p. 27, and 11, p. 82). Thus, centering CHAMBR at Y C = RM simulates a chamber curved with radius RM, and having a</span>
<span class="sd">    radial acceptance RM ± YL. In DRIFT, the testing is done at the beginning and at the end, and only for positive</span>
<span class="sd">    drifts. There is no testing in CHANGREF.</span>

<span class="sd">    When a particle is stopped, its index IEX (see OBJET and section 4.6.10) is set to the value -4, and its actual</span>
<span class="sd">    path length is stored in the array SORT for possible further use.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;CHAMBR&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;IA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;0 (element inactive), 1 ((re)definition of the aperture), 2 (stop testing and reset counters,&#39;</span>
                  <span class="s1">&#39;print information on stopped particles&#39;</span><span class="p">),</span>
        <span class="s1">&#39;IFORM&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;1 (rectangular aperture), 2 (elliptical aperture)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;J&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;0 (default) or 1&#39;</span><span class="p">),</span>
        <span class="s1">&#39;C1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="s1">&#39;If J=0, Y opening, if J=1, inner Y opening&#39;</span><span class="p">),</span>
        <span class="s1">&#39;C2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="s1">&#39;If J=0, Z opening, if J=1, outer Y opening&#39;</span><span class="p">),</span>
        <span class="s1">&#39;C3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="s1">&#39;If J=0, Y center, if J=1, inner Z opening&#39;</span><span class="p">),</span>
        <span class="s1">&#39;C4&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="s1">&#39;If J=0, Z center, if J=1, outer Z opening&#39;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">IA</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">IFORM</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C4</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<span class="c1"># Aliases</span>
<span class="n">Chamber</span> <span class="o">=</span> <span class="n">Chambre</span>
<span class="n">Chambr</span> <span class="o">=</span> <span class="n">Chambre</span>


<div class="viewcode-block" id="ChangRef"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.ChangRef.html#zgoubidoo.commands.commands.ChangRef">[docs]</a><span class="k">class</span> <span class="nc">ChangRef</span><span class="p">(</span><span class="n">Command</span><span class="p">,</span> <span class="n">_Patchable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transformation to a new reference frame.</span>

<span class="sd">    Supports only Zgoubi &quot;new style&quot; ChangeRef. To recover the &quot;old style&quot;, do XS, YS, ZR.</span>

<span class="sd">    ::note: `ChangRef` supports the `Patchable` interface and the transformations will thus be taken into account when</span>
<span class="sd">    surveying the line.</span>

<span class="sd">    .. rubric:: Zgoubi manual description</span>

<span class="sd">    TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;CHANGREF&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;TRANSFORMATIONS&#39;</span><span class="p">:</span> <span class="p">([],</span> <span class="s1">&#39;List of transformations for new style ChangeRef&#39;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRANSFORMATIONS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">_np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dimensionality</span> <span class="o">==</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">dimensionality</span><span class="p">:</span>
                <span class="n">cc</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_cm</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="k">elif</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dimensionality</span> <span class="o">==</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">radian</span><span class="o">.</span><span class="n">dimensionality</span><span class="p">:</span>
                <span class="n">cc</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_degree</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ZgoubidooException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Incorrect dimensionality in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cc</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span> <span class="o">+</span> <span class="n">cc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Q</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">cm</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">entry_patched</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Frame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_patched</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry_patched</span> <span class="o">=</span> <span class="n">_Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRANSFORMATIONS</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid transformation.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_entry_patched</span><span class="o">.</span><span class="n">translate_axis</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_entry_patched</span><span class="o">.</span><span class="n">rotate_axis</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_patched</span></div>


<span class="c1"># Alias</span>
<span class="n">ChangeRef</span> <span class="o">=</span> <span class="n">ChangRef</span>


<div class="viewcode-block" id="Collimateur"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Collimateur.html#zgoubidoo.commands.commands.Collimateur">[docs]</a><span class="k">class</span> <span class="nc">Collimateur</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Collimator.</span>

<span class="sd">    .. rubric:: Zgoubi manual description</span>

<span class="sd">    COLLIMA acts as a mathematical aperture of zero length. It causes the identification, counting and stop- ping of</span>
<span class="sd">    particles that reach the aperture limits.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;COLLIMA&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;IA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Element active or not (0 - inactive, 1 - active, 2 - active and prints information.&#39;</span><span class="p">),</span>
        <span class="s1">&#39;IFORM&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Aperture shape (1 - rectangular, 2 - elliptic (other options, see documentation).&#39;</span><span class="p">),</span>
        <span class="s1">&#39;J&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Description of the aperture coordinates system.&#39;</span><span class="p">),</span>
        <span class="s1">&#39;C1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="s1">&#39;Half opening (Y).&#39;</span><span class="p">),</span>
        <span class="s1">&#39;C2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="s1">&#39;Half opening (Z).&#39;</span><span class="p">),</span>
        <span class="s1">&#39;C3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="s1">&#39;Center of the aperture (Y).&#39;</span><span class="p">),</span>
        <span class="s1">&#39;C4&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="s1">&#39;Center of the aperture (Z).&#39;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">IA</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">IFORM</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C1</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C3</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C4</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<span class="c1"># Aliases</span>
<span class="n">Collima</span> <span class="o">=</span> <span class="n">Collimateur</span>
<span class="n">Collimator</span> <span class="o">=</span> <span class="n">Collimateur</span>


<div class="viewcode-block" id="Cible"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Cible.html#zgoubidoo.commands.commands.Cible">[docs]</a><span class="k">class</span> <span class="nc">Cible</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a secondary beam following target interaction.</span>

<span class="sd">    TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;CIBLE&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="FaiStore"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.FaiStore.html#zgoubidoo.commands.commands.FaiStore">[docs]</a><span class="k">class</span> <span class="nc">FaiStore</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Store coordinates at labeled elements.</span>

<span class="sd">    .. rubric:: Zgoubi manual description</span>

<span class="sd">    Store coordinates every IP other pass at labeled elements.</span>

<span class="sd">    If either FNAME or first LABEL is ’none’ then no storage occurs. Store occurs at all elements if first LABEL is</span>
<span class="sd">    ’all’ or ’ALL’.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;FAISTORE&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;FNAME&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;zgoubi.fai&#39;</span><span class="p">,</span> <span class="s1">&#39;Storage file name.&#39;</span><span class="p">),</span>
        <span class="s1">&#39;LABELS&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="s1">&#39;Label(s) of the element(s) at the exit of which the storage occurs (10 labels maximum).&#39;</span><span class="p">),</span>
        <span class="s1">&#39;IP&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Store every IP other pass (when using REBELOTE with NPASS ≥ IP − 1).&#39;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">FNAME</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">IP</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Focale"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Focale.html#zgoubidoo.commands.commands.Focale">[docs]</a><span class="k">class</span> <span class="nc">Focale</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Particle coordinates and horizontal beam size at distance XL.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;FOCALE&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;XL&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">centimeter</span><span class="p">,</span> <span class="s1">&#39;Distance from the location of the keyword.&#39;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="n">_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XL</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="FocaleZ"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.FocaleZ.html#zgoubidoo.commands.commands.FocaleZ">[docs]</a><span class="k">class</span> <span class="nc">FocaleZ</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Particle coordinates and vertical beam size at distance XL.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;FOCALEZ&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;XL&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">centimeter</span><span class="p">,</span> <span class="s1">&#39;Distance from the location of the keyword.&#39;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="n">_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XL</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="GasScattering"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.GasScattering.html#zgoubidoo.commands.commands.GasScattering">[docs]</a><span class="k">class</span> <span class="nc">GasScattering</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gas scattering.</span>

<span class="sd">    Modification of particle momentum and velocity vector, performed at each integration step, under the effect of</span>
<span class="sd">    scattering by residual gas.</span>

<span class="sd">    .. note:: Implementation is to be completed in Zgoubi.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;GASCAT&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;KGA&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;AI&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;DEN&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">KGA</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">AI</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">DEN</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="GetFitVal"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.GetFitVal.html#zgoubidoo.commands.commands.GetFitVal">[docs]</a><span class="k">class</span> <span class="nc">GetFitVal</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get values of variables as saved from former FIT[2] run.</span>

<span class="sd">    This keyword allows reading, from a file whose name needs be specified, parameter values to be assigned to optical</span>
<span class="sd">    elements in zgoubi.dat.</span>
<span class="sd">    That file is expected to contain a copy-paste of the data under the FIT[2] procedure as displayed in zgoubi.res,</span>
<span class="sd">    normally under the form.</span>

<span class="sd">    # STATUS OF CONSTRAINTS</span>
<span class="sd">    # TYPE  I   J  LMNT#     DESIRED       WEIGHT         REACHED         KI2     *  Parameter(s)</span>
<span class="sd">    #   3   1   2   127   0.0000000E+00  1.0000E+00    1.0068088E-08   6.0335E-01 *  0 :</span>
<span class="sd">    #   3   1   3   127   0.0000000E+00  1.0000E+00    7.0101405E-09   2.9250E-01 *  0 :</span>
<span class="sd">    #   3   1   4   127   0.0000000E+00  1.0000E+00    2.9184383E-10   5.0696E-04 *  0 :</span>
<span class="sd">    #   3   1   5   127   0.0000000E+00  1.0000E+00    3.1142381E-10   5.7727E-04 *  0 :</span>
<span class="sd">    #   3   1   2   436   0.0000000E+00  1.0000E+00    3.8438378E-09   8.7944E-02 *  0 :</span>
<span class="sd">    #   3   1   3   436   0.0000000E+00  1.0000E+00    1.5773011E-09   1.4808E-02 *  0 :</span>
<span class="sd">    #   3   1   4   436   0.0000000E+00  1.0000E+00    2.2081272E-10   2.9022E-04 *  0 :</span>
<span class="sd">    #   3   1   5   436   0.0000000E+00  1.0000E+00    5.7930552E-11   1.9975E-05 *  0 :</span>
<span class="sd">    #   Function  called   1859 times</span>
<span class="sd">    # Xi2 =    1.68006E-16   Busy...</span>

<span class="sd">    A ’#’ at the beginning of a line means it is commented, thus it will not be taken into account. However a copy-paste</span>
<span class="sd">    from zgoubi.res (which is the case in the present example) would not not need any commenting.</span>
<span class="sd">    Since some of the FIT[2] variables may belong in [MC]OBJET, GETFITVAL may appear right before [MC]OBJET in zgoubi.dat,</span>
<span class="sd">    to allow for its updating.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;GETFITVAL&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;FNAME&#39;</span><span class="p">:</span> <span class="s1">&#39;zgoubi.res&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">FNAME</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Histo"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Histo.html#zgoubidoo.commands.commands.Histo">[docs]</a><span class="k">class</span> <span class="nc">Histo</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;1-Dhistogram&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;HISTO&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Image"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Image.html#zgoubidoo.commands.commands.Image">[docs]</a><span class="k">class</span> <span class="nc">Image</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Localization and size of horizontal waist.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;IMAGE&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Images"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Images.html#zgoubidoo.commands.commands.Images">[docs]</a><span class="k">class</span> <span class="nc">Images</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Localization and size of horizontal waists.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;IMAGES&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="ImageZ"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.ImageZ.html#zgoubidoo.commands.commands.ImageZ">[docs]</a><span class="k">class</span> <span class="nc">ImageZ</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Localization and size of vertical waist.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;IMAGEZ&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="ImagesZ"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.ImagesZ.html#zgoubidoo.commands.commands.ImagesZ">[docs]</a><span class="k">class</span> <span class="nc">ImagesZ</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Localization and size of vertical waists.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;IMAGESZ&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Marker"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Marker.html#zgoubidoo.commands.commands.Marker">[docs]</a><span class="k">class</span> <span class="nc">Marker</span><span class="p">(</span><span class="n">Command</span><span class="p">,</span> <span class="n">_Patchable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Marker.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;MARKER&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label1</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label2</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="n">with_plt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">label1</span><span class="p">,</span> <span class="n">label2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PARAMETERS</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">LABEL2</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LABEL2</span> <span class="o">=</span> <span class="s1">&#39;.plt&#39;</span> <span class="k">if</span> <span class="n">with_plt</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Matrix"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Matrix.html#zgoubidoo.commands.commands.Matrix">[docs]</a><span class="k">class</span> <span class="nc">Matrix</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculation of transfer coefficients, periodic parameters.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;MATRIX&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;IORD&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;IFOC&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;If IFOC=11, periodic parameters (single pass)&#39;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">IORD</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">IFOC</span><span class="si">}</span><span class="s2"> PRINT</span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="MCDesintegration"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.MCDesintegration.html#zgoubidoo.commands.commands.MCDesintegration">[docs]</a><span class="k">class</span> <span class="nc">MCDesintegration</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Monte-Carlo simulation of in-flight decay.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;MCDESINT&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Optics"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Optics.html#zgoubidoo.commands.commands.Optics">[docs]</a><span class="k">class</span> <span class="nc">Optics</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write out optical functions.</span>

<span class="sd">    OPTICS normally appears next to object definition, it normally works in conjunction with element label(s).</span>
<span class="sd">    OPTICS causes the transport and write out, in zgoubi.res, of the 6×6 beam matrix, following options KOPT and</span>
<span class="sd">    ’label ’, below.</span>

<span class="sd">    IF KOPT=0 : Off</span>
<span class="sd">    IF KOPT=1 : Will transport the optical functions with initial values as specified in OBJET, option KOBJ=5.01.</span>

<span class="sd">    *Note*: The initial values in OBJET[KOBJ=5.01] may be the periodic ones, as obtained, for instance, from a first</span>
<span class="sd">    run using MATRIX[IFOC=11].</span>

<span class="sd">    A second argument, ’label ’, allows</span>

<span class="sd">        - if label = all : printing out, into zgoubi.res, after all keywords of the zgoubi.dat structure,</span>
<span class="sd">        - otherwise, printing out at all keyword featuring LABEL ≡ label as a first label (see section 4.6.5,</span>
<span class="sd">          page 162, regarding the labelling of keywords).</span>

<span class="sd">    A third argument, IMP=1, will cause saving of the transported beta functions into file zgoubi.OPTICS.out.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;OPTICS&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;IOPT&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;LABEL&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;If IFOC=11, periodic parameters (single pass)&#39;</span><span class="p">),</span>
        <span class="s1">&#39;IMP&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">IOPT</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LABEL</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">IMP</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Ordre"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Ordre.html#zgoubidoo.commands.commands.Ordre">[docs]</a><span class="k">class</span> <span class="nc">Ordre</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Taylor expansions order.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;ORDRE&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Pickups"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Pickups.html#zgoubidoo.commands.commands.Pickups">[docs]</a><span class="k">class</span> <span class="nc">Pickups</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Beam centroid path; closed orbit.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;PICKUPS&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="PlotData"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.PlotData.html#zgoubidoo.commands.commands.PlotData">[docs]</a><span class="k">class</span> <span class="nc">PlotData</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Intermediate output for the PLOTDATA graphic software.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;PLOTDATA&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Rebelote"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Rebelote.html#zgoubidoo.commands.commands.Rebelote">[docs]</a><span class="k">class</span> <span class="nc">Rebelote</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;’Do it again’.&quot;&quot;&quot;</span>

    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;REBELOTE&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;NPASS&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;KWRIT&#39;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span>
        <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span>
        <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;LABL1&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;LABL2&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;NPRM&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">NPASS</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">KWRIT</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LABL1</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LABL2</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Reset"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Reset.html#zgoubidoo.commands.commands.Reset">[docs]</a><span class="k">class</span> <span class="nc">Reset</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reset counters and flags.</span>

<span class="sd">    .. rubric:: Zgoubi manual description</span>

<span class="sd">    Piling up problems in zgoubi input data file is allowed, with normally no particular precaution, except that each</span>
<span class="sd">    new problem must begin with a new object definition (using MCOBJET, OBJET). Nevertheless, when calling upon certain</span>
<span class="sd">    keywords, then, flags, counters or other integrating procedures may be involved. It may therefore be necessary to</span>
<span class="sd">    reset them. This is the purpose of RESET which normally appears right before the object definition and causes each</span>
<span class="sd">    problem to be treated as a new and independent one.</span>

<span class="sd">    The keywords or procedures of concern and the effect of RESET are the following:</span>

<span class="sd">        - **CHAMBR**: number of stopped particles reset to 0 ; CHAMBR option switched off</span>
<span class="sd">        - **COLLIMA**: number of stopped particles reset to 0</span>
<span class="sd">        - **HISTO**: histograms are emptied</span>
<span class="sd">        - **INTEG**: number of particles out of field map boundaries reset to 0</span>
<span class="sd">        - **MCDESINT**: decay in flight option switched off, counter reset</span>
<span class="sd">        - **PICKUPS**: pick-up signal calculation switched off</span>
<span class="sd">        - **SCALING**: scaling functions disabled</span>
<span class="sd">        - **SPNTRK**: spin tracking option switched off</span>

<span class="sd">    .. rubric:: Zgoubidoo usage and example</span>

<span class="sd">    &gt;&gt;&gt; Reset()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;RESET&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Scaling"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Scaling.html#zgoubidoo.commands.commands.Scaling">[docs]</a><span class="k">class</span> <span class="nc">Scaling</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Power supplies and R.F. function generator.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;SCALING&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        1 1</span>
<span class="s2">        QUADRUPO</span>
<span class="s2">        -1</span>
<span class="s2">        1</span>
<span class="s2">        1</span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Separa"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Separa.html#zgoubidoo.commands.commands.Separa">[docs]</a><span class="k">class</span> <span class="nc">Separa</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wien Filter - analytical simulation.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;SEPARA&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Target"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Target.html#zgoubidoo.commands.commands.Target">[docs]</a><span class="k">class</span> <span class="nc">Target</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a secondary beam following target interaction.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;TARGET&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="TransferMatrix"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.TransferMatrix.html#zgoubidoo.commands.commands.TransferMatrix">[docs]</a><span class="k">class</span> <span class="nc">TransferMatrix</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transfer matrix.</span>

<span class="sd">    .. rubric:: Zgoubi manual description</span>

<span class="sd">    TRANSMAT performs a second order transport of the particle coordinates using R and T. [Rij] ([Tijk]) is the first</span>
<span class="sd">    order (second order) transfer matrix as usually involved in second order beam optics [28]. Second order transfer</span>
<span class="sd">    is optional. The length of the element represented by the matrix may be introduced for the purpose of path length</span>
<span class="sd">    updating.</span>

<span class="sd">    .. Note:: MATRIX delivers [Rij] and [Tijk] matrices in a format suitable for straightforward use with TRANSMAT.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;TRANSMAT&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="TranslationRotation"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.TranslationRotation.html#zgoubidoo.commands.commands.TranslationRotation">[docs]</a><span class="k">class</span> <span class="nc">TranslationRotation</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Translation-Rotation of the reference frame.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;TRAROT&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;TX&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="s1">&#39;X axis translation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;TY&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="s1">&#39;Y axis translation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;TZ&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="s1">&#39;Z axis translation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;RX&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="s1">&#39;X axis rotation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;RY&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="s1">&#39;Y axis rotation&#39;</span><span class="p">),</span>
        <span class="s1">&#39;RZ&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="s1">&#39;Z axis rotation&#39;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optinally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="n">_m</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">TX</span><span class="p">)</span><span class="si">:</span><span class="s2">.12e</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_m</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">TY</span><span class="p">)</span><span class="si">:</span><span class="s2">.12e</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_m</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">TZ</span><span class="p">)</span><span class="si">:</span><span class="s2">.12e</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_radian</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">RX</span><span class="p">)</span><span class="si">:</span><span class="s2">.12e</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_radian</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">RY</span><span class="p">)</span><span class="si">:</span><span class="s2">.12e</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_radian</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">RZ</span><span class="p">)</span><span class="si">:</span><span class="s2">.12e</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<span class="n">TraRot</span> <span class="o">=</span> <span class="n">TranslationRotation</span>


<div class="viewcode-block" id="Twiss"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Twiss.html#zgoubidoo.commands.commands.Twiss">[docs]</a><span class="k">class</span> <span class="nc">Twiss</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculation of periodic optical parameters.&quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;TWISS&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="n">PARAMETERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;KTW&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;FACD&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="s1">&#39;FACA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;Unused&#39;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;Parameters of the command, with their default value, their description and optionally an index used by other </span>
<span class="sd">    commands (e.g. fit).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">KTW</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">FACD</span><span class="si">:</span><span class="s2">.12e</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">FACA</span><span class="si">:</span><span class="s2">.12e</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Ymy"><a class="viewcode-back" href="../../../api/zgoubidoo.commands.commands.Ymy.html#zgoubidoo.commands.commands.Ymy">[docs]</a><span class="k">class</span> <span class="nc">Ymy</span><span class="p">(</span><span class="n">Command</span><span class="p">,</span> <span class="n">_Patchable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reverse signs of Y and Z reference axes, equivalent to a 180 degree rotation around the X axis.</span>
<span class="sd">    </span>
<span class="sd">    This is particularly useful for example in combination with a `Dipole` that needs to be flipped so that the </span>
<span class="sd">    geometry matches the negative field value.</span>

<span class="sd">    ..note: YMY reverses the signs of all transverse variables (Y, T, Z, P); despite its name.</span>

<span class="sd">    TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">KEYWORD</span> <span class="o">=</span> <span class="s1">&#39;YMY&#39;</span>
    <span class="sd">&quot;&quot;&quot;Keyword of the command used for the Zgoubi input data.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">entry_patched</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Frame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_patched</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry_patched</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entry</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entry_patched</span><span class="o">.</span><span class="n">rotate_x</span><span class="p">(</span><span class="mi">180</span> <span class="o">*</span> <span class="n">_ureg</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entry_patched</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018-2020, Cédric Hernalsteens (cedric.hernalsteens@ulb.be)

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>